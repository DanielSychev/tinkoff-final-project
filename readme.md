# Сервис объявлений на Go

## Описание проекта

Этот проект представляет собой сервис для работы с объявлениями, реализованный на языке Go с использованием принципов чистой архитектуры. Сервис предоставляет REST и gRPC интерфейсы для управления 
и хранения объявлений и пользователей.


## Технические особенности
- Реализованы REST и gRPC интерфейсы
- Хранение данных в PostgreSQL
- Поддержка graceful shutdown
- Логирование с помощью кастомного логгера
- Panic middleware/interceptor
- Юнит-тесты для всех основных методов
- Использование принципов чистой архитектуры
- Docker-контейнеризация
---
## Запуск проекта

### Требования
- Docker
- Docker Compose

### Запуск с помощью Docker Compose
1. Клонируйте репозиторий
2. Перейдите в директорию проекта
3. Запустите сервисы:
```bash
docker-compose up -d
````
4. Остановить сервис:
```bash
docker-compose down
````
5. Сбросить хранилище:
```bash
docker-compose down -v
````
---
## Функциональность

### Управление объявлениями
- Создание новых объявлений
- Публикация/снятие с публикации объявлений (только для автора)
- Изменение текста объявлений (только для автора)
- Получение объявления по ID
- Получение списка объявлений с фильтрами:
  - Только опубликованные
  - По автору
  - По дате создания
- Удаление объявлений (только для автора)

### Управление пользователями
- Создание и редактирование пользователей
- Получение информации о пользователе
- Удаление пользователя

# Ads API (REST)

REST API для управления объявлениями и пользователями.  
Базовый URL: `http://localhost:8081/api/v1/`

---

## Объявления

### Создание объявления

**POST** `/ads`

**Request Body:**
```json
{
  "title": "string",
  "text": "string",
  "user_id": 1
}
```

---

### Обновление текста объявления (доступно только автору)

**PUT** `/ads/:id`

**Request Body:**
```json
{
  "title": "new title",
  "text": "new text",
  "user_id": 1
}
```

---

### Публикация или снятие с публикации объявления (доступно только автору)

**PUT** `/ads/:id/status`

**Request Body:**
```json
{
  "user_id": 1,
  "published": true
}
```

---

### Получение объявления по ID

**GET** `/ads/:id`

---

### Получение списка объявлений с фильтрами

**GET** `/ads`

**Query параметры (необязательные):**
- `auth=1` - **author_id**
- `pub=true` - **published**
- `title=example` - **title**

---

### Удаление объявления (доступно только автору)

**DELETE** `/ads/:id/del`

**Query параметр:**
- `user_id=1`

---

## Пользователи

### Создание пользователя

**POST** `/users`

**Request Body:**
```json
{
  "name": "Alice"
}
```

---

### Получение информации о пользователе

**GET** `/users/:id`

---

### Удаление пользователя

**DELETE** `/users/:id/del`

---

## Примеры ответов

### AdResponse
```json
{
  "id": 1,
  "title": "Title",
  "text": "Text",
  "author_id": 123,
  "published": true,
  "date_created": "2025-05-11T10:00:00Z",
  "date_updated": "2025-05-11T10:00:00Z"
}
```

### UserResponse
```json
{
  "id": 1,
  "name": "Alice"
}
```
---
## Обработка ошибок

- **400 Bad Request** — ошибки валидации
- **403 Forbidden** — попытка изменить чужое объявление
- **404 Not Found** — несуществующий ресурс
- **500 Internal Server Error** — внутренняя ошибка сервера
---

# Ads API (gRPC)

gRPC API для управления объявлениями и пользователями.  
Базовый формат взаимодействия описан в файле `service.proto`.  
Базовый Path: `grpc://localhost:1011/`  
Рекомендуемые клиенты:
- [grpcurl](https://github.com/fullstorydev/grpcurl)
- Postman (с gRPC)
- Go-клиент с сгенерированным кодом из `ad.proto`
---

## Структура данных

### Объявление
- Уникальный идентификатор (int64)
- Название (string)
- Текст (string)
- Идентификатор автора (int64)
- Статус публикации (bool)
- Дата создания (time)
- Дата обновления (time)

### Пользователь
- Уникальный идентификатор (int64)
- Nickname (string)
- Email (string)
---
## Валидация
### Для объявлений:
- Название не должно быть пустым
- Название должно быть короче 100 символов
- Текст объявления не должен быть пустым
- Текст объявления должен быть короче 500 символов

### Безопасность:
- Изменение объявления разрешено только его автору
- Попытки изменения другими пользователями возвращают ошибку 403

